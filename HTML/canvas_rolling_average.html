<canvas id="canvas" width=1024 height=400></canvas>

<script>
  var canvas = document.getElementById("canvas");
  var ctx = canvas.getContext("2d");

  function drawbar(x, y1, y2) {
    ctx.beginPath();
    ctx.moveTo(x, y1);
    ctx.lineTo(x, y1+y2)
    ctx.stroke();
  }

  async function start() {
    const peaksReq = await fetch("https://raw.githubusercontent.com/bbc/peaks.js/master/demo/TOL_6min_720p_download.json");
    const peaks = (await peaksReq.json()).data;
    
    var s = 600
    var ra = [0,0,0,0,0];
    for (let i = s; i < s+800; i+=2) {
      drawbar((i - s) * 1.5, 50, peaks[i])      

      //rolling average
      ra.shift();
      ra.push(peaks[i])
      ave = ra.reduce((a, b) => a + b, 0)/ra.length
      drawbar((i - s) * 1.5, 100, ave)      
    } 
  }

  start()
</script>